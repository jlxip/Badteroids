* Badteroids: Documento de Dise침o
** Conceptos
*** Introducci칩n
Badteroids es un juego competitivo en 2D para Linux. Tras un enfrentamiento entre dos naciones de Andr칩meda, la Federaci칩n Gal치ctica y la Ciudadela, la segunda se propone destruir la galaxia, y la primera deber치 de impedirlo, cada una en un aeronave de su Estado, lado a lado.
*** /Background/
Badteroids se propone como el juego a desarrollar para la asignatura Programaci칩n L칰dica de la carrera de Ingenier칤a Inform치tica de la UGR. Por la imposibilidad de dedicarle mucho tiempo, se intentar치n mantener unos objetivos lo m치s modestos posibles pero llev치ndolos bien a cabo.

Adem치s, escrito en C++ y OpenGL, usando metodolog칤a de dise침o orientado a datos en la mayor칤a de casos, Badteroids es una /oda al bajo nivel/, y esto se puede apreciar en todo momento en el juego.
*** Descripci칩n
El punto del juego es competir localmente. Por esto, la idea m치s importante, y la que se tendr치 en mente para cada decisi칩n, ser치 que un videojuego de este tipo es m치s divertido cuando las acciones de un jugador repercuten sobre el otro, en lugar de considerar un sistema de puntuaci칩n aislado. Ser치, adem치s, cr칤tico evitar la monoton칤a interna (durante las partidas), as칤 como la externa (de partida en partida).
*** Caracter칤sticas clave
- *PVP*: los jugadores combaten el uno contra el otro con tal de frenar su progreso o debilitarlos.
- *PVE*: los jugadores se abastecen de los recursos necesarios para avanzar y se defienden de ataques de un entorno inh칩spito.
- *Niveles* generados proceduralmente para mantener cada partida 칰nica.
- *Partidas cortas* para no prolongar la tensi칩n m치s tiempo del necesario.
*** G칠nero
Badteroids sigue los g칠neros /arcade en 2D/, /casual/, /retro/, y /acci칩n/. Adem치s, con respecto al gameplay, es /multijugador local/ de /pantalla dividida/.
*** Plataforma
La plataforma objetivo es GNU/Linux. Existir치 la posibilidad de fabricar binarios independientes de la arquitectura solo si no se requiere complicar el c칩digo para ello, pero GNU/Linux es la plataforma principal.
*** Arte conceptual
[[./imgs/main_idea.png]]
** Gameplay y mec치nicas
*** N칰cleo del gameplay
La idea detr치s del gameplay es modesta: en pantalla dividida, los jugadores avanzan e intentan evitar el avance de su oponente.
**** Movimiento
Uno de los intereses de Badteroids se encuentra en que los sucesos ocurren en el espacio. Por lo tanto, no hay presencia de atm칩sfera, sino vac칤o. As칤, todo movimiento no es frenado por el rozamiento del aire, sino que el momento lineal se conserva. Cada pulsaci칩n de tecla conlleva un incremento de velocidad en un eje a costa de una disminuci칩n del recurso que se expulsa para conseguir dicho movimiento. Aplica, entonces, la primera ley de Newton: para frenar, es necesario crear un empuje (/thrust/) en el sentido opuesto.

El jugador deber치 tener cuidado con no pasar los l칤mites de la pantalla. De colisionar con uno, perder치 la partida.

Con tal de mantener la atenci칩n del jugador, la nave no puede mantenerse en reposo (relativo a la pantalla). Siempre toma lugar un peque침o movimiento incorregible. Comienza siendo uno peque침o hacia arriba a la derecha, en el caso de la nave de la izquierda, y hacia arriba a la izquierda en el caso de la de la derecha. Adem치s, cada vez que el jugador efect칰a un movimiento, se produce una desviaci칩n aleatoria de hasta el +5%.

**** Combate
La nave tiene un arma: el l치ser, que realiza un disparo desde proa, y no consume recursos.

Un jugador deber치 debilitar al oponente con tal de frenar su avance. De no preocuparse por ello, el otro jugador ganar치 por tiempo. En caso de ambos no combatir, gana la Ciudadela.

El combate se realiza por medio de /habilidades/. Tienen cooldown definido que depende de cada una, as칤 como un coste de recursos. Se comienza con una, que estabiliza la nave a un estado de casi reposo en comparaci칩n con la pantalla, pero consume 10 de ox칤geno en su uso, y tiene un cooldown de 5 segundos.

Cada cierto tiempo, aleatorizado, aparece un asteroide rojo en las pantallas de ambos jugadores. Destruirlo y capturar su drop implica desbloquear la siguiente habilidad secuencial. De no capturar el drop, la habilidad no ser치 perdida, pero el jugador se ver치 obligado a esperar al siguiente asteroide de este tipo para conseguirla, lo que da una ventaja temporal al otro jugador que posiblemente conlleve su victoria.

Las habilidades disponibles son:

| N칰mero | Nombre      | $H_2$ | $O_2$ | Cooldown | Descripci칩n                                                        |
|--------+-------------+-------+-------+----------+--------------------------------------------------------------------|
|      1 | Estabilizar |     0 |    10 |        5 | Lleva la nave a un estado muy pr칩ximo al reposo relativo           |
|      2 | Descalibrar |    20 |     5 |       20 | Aumenta la desviaci칩n del oponente en un 5000% durante 10 segundos |

**** Avance
Con tal del avanzar, los jugadores deber치n:

- Intentar defenderse mediante el uso de habilidades.
- Esquivar o destruir los asteroides del entorno.
- Repostar los recursos necesarios para mantener la nave en marcha.
*** Flujo de la partida
El flujo es por naturaleza lineal: ambos intentan avanzar en un camino fijo hacia el agujero negro que sostiene la galaxia. Durante el proceso, encontrar치n de forma consistente:

- Asteroides de distintos tama침os que deber치n de esquivar o destruir.
- Peque침os asteroides que contienen recursos, que podr치n capturar y as칤 repostar.

Conforme avance la carrera y los jugadores se aproximen al centro, ir치 cambiando el escenario. Esto evitar치 mantener un gameplay id칠ntico. Durante las distintas fases:

- Ir치n cambiando los colores del entorno.
- Aparecer치n amenazas diferentes. Por ejemplo, mientras se cruza el /cintur칩n de asteroides/ habr치 m치s de estos de un tama침o m치s reducido.
- Habr치 ligeras alteraciones en el PVP. Por ejemplo, ataques que solo existen durante cierta parte de la carrera.

Estos cambios durante el gameplay le dan un ligero toque de estrategia al juego. Podr치 ser conveniente realizar ciertas acciones en ciertos momentos de la partida. Por ejemplo, m치s cerca del agujero negro algunos ataques costar치n menos recursos por poder aprovecharse de la aceleraci칩n gravitatoria de este.
*** Naciones
**** Federaci칩n Gal치ctica
La Federaci칩n Gal치ctica es una dictadura aut치rquica. Sus aeronaves, as칤, tienen un estilo serio, y se enfocan a ofrecer la m치xima velocidad de movimiento para esquivar asteroides y espacio para armas. /Nada imprescindible a bordo/ es su principal preocupaci칩n. Por esto, tienen dep칩sitos m치s peque침os para recursos, necesitan repostar m치s a menudo, y sus maniobras defensivas tienen poca duraci칩n.
**** La Ciudadela
Tras la formaci칩n de la Federaci칩n, individuos contrarios al r칠gimen, libertarios por naturaleza, fueron marcados como /personas no gratas/. Se exiliaron y formaron /La Ciudadela/, que sigue recibiendo nuevos miembros de forma constante. Sus aeronaves tienen un estilo m치s /duct tape/, enfocadas en /mantenerse de una pieza/. Esto lo consiguen con mejores defensas y mayores tanques de recursos. A cambio, sacrifican impresionantes maniobras ofensivas y velocidad de movimiento.
*** Recursos
En su viaje, las aeronaves encuentran asteroides de reabastecimiento, que contienen recursos necesarios para mantener la nave funcionando. Deber치n ser destruidos y colisionar con su objeto droppeado.
**** Hidr칩geno
El hidr칩geno hace de combustible en Badteroids. Quedarse sin 칠l implicar칤a cesar de acelerar y perder as칤 la partida. Se utiliza, adem치s, para cargar armas y escudos en el breve instante durante el que est칠n disponibles.
**** Ox칤geno
Todo ser vivo, y esto incluye los seres de Andr칩meda, necesita ox칤geno para mantener una atm칩sfera en la cual sobrevivir. No siendo esto bastante, es adem치s necesario en peque침as cantidades como catalizador en las combustiones de hidr칩geno. Quedarse sin ox칤geno conllevar칤a la muerte inmediata del comandante.
*** Fases de la carrera
**** Longitud
Se busca una duraci칩n de partida de 5 minutos desde el inicio hasta el agujero negro. Por efectos gravitatorios, cuanto m치s cerca se est칠, m치s r치pido decrecer치 la distancia (en p치rsecs). Se puede fijar la distancia a recorrer en 1000 p치rsecs. Se busca, as칤, la aceleraci칩n.

Se trata de un movimiento rectil칤neo uniformemente acelerado, y su ecuaci칩n es: $e=\frac{1}{2} a t^2 + v_0 t + e_0$. En $t=0$, la distancia es m치xima ($e = e_0 = 1000$). Se parte desde el reposo, $v_0=0$. Con todo esto, $0 = \frac{1}{2} a \cdot 5^2 + 1000 \iff -1000 = 12.5 a \iff a = -80 \; pc/m^2 = -0.02222 \; pc/s^2$.
*** Controles
Los controles est치n pensados para ser jugados por cada jugador con su mano derecha, ambos sobre el teclado.

Para el jugador de la izquierda, los controles son:
- ~W~: propulsi칩n proa.
- ~A~: propulsi칩n babor.
- ~S~: propulsi칩n popa (retropopulsi칩n).
- ~D~: propulsi칩n estribor.
- ~Q~: disparo l치ser.
- ~E~: efectuar habilidad seleccionada.
- ~Z~: seleccionar la habilidad anterior en la lista.
- ~X~: seleccionar la habilidad siguiente en la lista.

Para el de la derecha, son an치logos, pero con ~IJKL~ en lugar de ~WASD~. Entonces, ~QEZX~ ser칤an ~UOM,~.

** Interfaz y gr치ficos
*** Men칰s
Badteroids tiene tres pantallas de men칰: la principal, la de ajustes, y la de pausa.
**** Men칰 principal
Se muestra al iniciar el juego. Su fondo es el usual de Badteroids, salvo que es est치tico. Contiene el t칤tulo del videojuego, y tres opciones:
- /PLAY/, para comenzar una nueva partida.
- /SETTINGS/, abre el men칰 de ajustes.
- /EXIT/, para salir.

**** Men칰 de ajustes
Al entrar en /SETTINGS/ dentro del men칰 principal, aparecen opciones de ajustes del juego, bajo el r칩tulo /SETTINGS/, y sobre un bot칩n /BACK/ para volver. Los cambios deber치n guardarse autom치ticamente al modificarse, y permanecer al reiniciar el juego.

- /VSync/Flex mode/, selecciona entre dos modos de dibujado de frames: VSync, es decir, una vez entre refresco de pantallas, lo que evita el tearing, y /Flex mode/, es decir, sin l칤mite de FPS, para poder medir los valores que alcanza el juego. Por defecto, se usa VSync.
- /MSAA/, selecciona el nivel de Multi-Sample Anti-Aliasing a usar. Los valores posibles son: 0, 2, 4, 8, 16, y 32. Por defecto, se usa MSAAx16.
- /FPS off/on/, permite elegir entre mostrar los FPS en la esquina superior izquierda de la pantalla u ocultarlos. Por defecto, no se muestran.

**** Men칰 de pausa
Durante una partida, pulsar cualquiera de las teclas CTRL pausa el juego. Se permite de esta manera para que ambos jugadores puedan pausar en todo momento. En este men칰, bajo el r칩tulo /PAUSE/, se muestran dos opciones:
- /RESUME/, para continuar el juego. Pulsar de nuevo CTRL tiene la misma acci칩n. De seleccionarse esta opci칩n, se reanuda la partida.
- /EXIT/, para abandonar la partida y volver al men칰 principal.

*** HUD
Durante una partida, existen ciertos metaelementos en primer plano que aportan informaci칩n sobre el juego. El indicador de FPS, de estar activo, est치 en la esquina superior izquierda.

Bajo el contador de FPS est치 la informaci칩n para el jugador izquierdo, y en su respectiva posici칩n en la parte derecha de la pantalla est치 la del jugador derecho.

La informaci칩n muestra la cantidad de hidr칩geno en forma de texto (sobre 100), y, bajo ella, la de ox칤geno.

En la parte superior central de la pantalla, se encuentra un medidor de distancia hasta el centro del agujero negro.
*** Asteroides
Los asteroides son grafos completos (K_n) de distintos tama침os, velocidades, y n칰mero de v칠rtices, que aparecen girando desde la parte superior de la pantalla. Los m치s peque침os giran m치s r치pido. Con cada disparo, el n칰mero de v칠rtices decrece hasta ser un tri치ngulo. Disparar un tri치ngulo implica destruirlo.

Los asteroides normales son verdes. Los que contienen hidr칩geno, blancos. Los que tienen ox칤geno, azules. Y los de habilidad, rojos.
*** El fondo
En la partida, en todo momento hay un fondo estelado, cargado de una textura generada aleatoriamente en el momento. Se genera proceduramente, lo que no limita la resoluci칩n a la que se debe jugar.

Adem치s, el fondo est치 en todo momento en movimiento para dar la sensaci칩n de velocidad. Al principio, el movimiento es lento. Cuando se acerca el final del juego, la atracci칩n gravitatoria del agujero negro es mayor, lo que provoca una fuerza (aceleraci칩n) mayor, y el movimiento del fondo es mayor.
** Generaci칩n de mundo
*** Asteroides
Los asteroides se generan aleatoriamente. Conforme progresa la partida, cambian sus propiedades:
- Tipo
- Periodo de generaci칩n
- Velocidad de movimiento
- Tama침o
- N칰mero de v칠rtices

Al inicio del juego, se genera un asteroide cada dos segundos, con velocidad de movimiento 1.

El periodo de generaci칩n no genera los asteroides de forma uniforme. Para evitar la monoton칤a, al inicio del periodo (/gap/) se genera aleatoriamente un deadline dentro del rango dado, y, al pasarlo, se emite.

La velocidad de movimiento es un multiplicador condicionado al tama침o del asteroide: los m치s peque침os se mueven m치s r치pido.

Su coordenada X es generada aleatoriamente.

El tipo es elegido aleatoriamente. Puede ser normal (70%), de hidr칩geno (20%), o de ox칤geno (10%).

Los asteroides de habilidad no son generados de la misma manera que el resto. Supongamos que el n칰mero de habilidades totales es $n$. Se comienza con una, con lo que se han de generar, durante la partida $n-1$ asteroides de este tipo. Se divide el tiempo de la partida (5 minutos, 300 segundos) en franjas de $\frac{300}{n}$ segundos. La 칰ltima se deja vac칤a, porque dar una habilidad tan pr칩xima al final no tiene sentido. Dentro de las otras franjas, se emite un asteroide rojo en cualquier punto de ellas, de forma an치loga a lo explicado anteriormente.

Con tal de ser m치s f치cil de acertar, el asteroide rojo es de un tama침o fijo mayor al resto, y siempre aparece en la mitad de la pantalla.
** Mercado
Badteroids est치 bajo la licencia de /izquierdos de autor/ GNU General Public License v3, y su distribuci칩n se llevar치 a cabo en este mismo repositorio de GitHub de forma gratuita, sin modo oficial de pagar por 칠l.
** Historial de cambios
*** Versi칩n 0.10
- En "Gampelay y mec치nicas -> N칰cleo del gameplay -> Combate", se explican las habilidades.
- En "Generaci칩n de mundo -> Asteroides", se ha a침adido el de habilidad.
- En "Gameplay y mec치nicas", se ha a침adido "Controles"
- En "Gameplay y mec치nicas -> N칰cleo del gameplay -> Movimiento", ahora la desviaci칩n es del +5% en lugar de m치s-menos, para hacer posible la habilidad "Descalibrar".
- En "Conceptos -> Background", especificado que el OOD se usa en la mayor칤a de casos 游
*** Versi칩n 0.9
- En "Gameplay y mec치nicas", se ha comenzado "Fases de la carrera", que estaba pendiente hasta ahora.
- En "Interfaz y gr치ficos -> HUD", menci칩n al contador de distancia.
*** Versi칩n 0.8
- En "Gameplay y mec치nicas -> N칰cleo del gameplay -> Combate", ahora solo se menciona la existencia de un arma, el l치ser, que es la 칰nica factible de hacer en el tiempo dado.
- En "Interfaz y gr치ficos", a침adida secci칩n "HUD".
- En "Generaci칩n de mundo -> Asteroides", a침adida menci칩n al tipo.
*** Versi칩n 0.7
- En "Gameplay y mec치nicas -> N칰cleo del gameplay -> Combate", se ha descartado la tercera ley de Newton al disparar. No solo porque no tiene sentido f칤sico (es un l치ser), sino, m치s bien, porque ha resultado en un gameplay demasiado dif칤cil de controlar, abrumador.
- En "Gameplay y mec치nicas -> Recursos", se ha descartado la idea de mantener un tiempo agarrado el asteroide de reabastecimiento, pues, a칰n antes de implementarlo, se ha visto conforme ha avanzado el proyecto que no resultar칤a divertido. En su lugar, droppean un objeto abstracto.
- En "Interfaz y gr치ficos", se ha a침adido "Asteroides".
- En "Generaci칩n de mundo", se ha a침adido tambi칠n "Asteroides".
*** Versi칩n 0.6
- En "Conceptos -> Background", p치rrafo sobre "oda al bajo nivel".
- En "Interfaz y gr치ficos -> Men칰s", "Men칰 de pausa".
*** Versi칩n 0.5
- En "Interfaz y gr치ficos", secci칩n sobre los men칰s.
*** Versi칩n 0.4
- En "Gameplay y mec치nicas", especificaci칩n del arma l치ser.
*** Versi칩n 0.3
- Comenzado "Interfaz y gr치ficos" con "El fondo"
*** Versi칩n 0.2.1
- Cambiada la desviaci칩n aleatoria de movimiento de +5% a 췀5%.
*** Versi칩n 0.2
- A침adida mec치nica de movimiento inercial y con desviaci칩n aleatoria.
*** Versi칩n 0.1
- Primera redacci칩n del documento.
